# 日本市場セクターサイクル・コメットチャート (Japan Sector Cycle Comet Chart)

このリポジトリは、日本の株式市場（TOPIX-17業種）のデータを解析し、現在の景気循環（セクターローテーション）の位置を可視化するシステムです。

GitHub Actionsを用いて毎日自動で計算を行い、生成されたチャートをGitHub Pagesでホストし、WordPressの固定ページに埋め込み更新を行います。

## プロジェクト概要

セクターローテーション理論に基づき、日本市場を代表する12業種の株価モメンタムを「ベクトル合成」することで、**日本経済がいま「回復・好況・後退・不況」のどのフェーズにあるか**を1つの点（重心）として描画します。

### 特徴
* **コメットチャート:** 過去365日分の軌跡（尻尾）と現在地（頭）を描画し、景気の流れる方向を可視化。
* **ノイズ除去:** 動きの鈍い業種や国策銘柄を除外し、純粋な景気敏感度を持つ12業種のみを選抜。
* **完全自動化:** 平日の夕方に自動実行され、サイトが更新されます。
* **サーバーレス:** Python環境はGitHub Actions上で完結し、サーバー維持費がかかりません。

---

## システムアーキテクチャ

このシステムは「GitHub Pages + Iframe埋め込み」方式を採用しており、WordPress側のスクリプト制限を回避しつつ、高速かつ安定した表示を実現しています。

```mermaid
graph TD
    A[GitHub Actions (Cron)] -->|平日 18:00 JST| B(Python Script Run)
    B -->|yfinance| C{株価データ取得}
    C --> D[ベクトル演算 & 重心計算]
    D --> E[index.html 生成]
    E -->|Deploy| F[GitHub Pages]
    D --> G[WordPress API]
    F -.->|Iframe参照| G
    G --> H((Webサイト表示))
```

1. **データ取得:** `yfinance` で過去2年分の株価を取得。
2. **計算:** 200日移動平均線乖離率をもとに、市場の重心を算出。
3. **ホスティング:** 生成した `index.html` (Chart.js) を `gh-pages` ブランチへデプロイ。
4. **サイト更新:** WordPressの固定ページに対し、上記ページを読み込む `<iframe>` タグを送信。

---

## 計算ロジックとアルゴリズム

本システムの中核となる、景気判定の数学的ロジックです。

### 1. 象限の定義 (Phase Definition)

景気サイクルを時計回りに4つの象限に分割しています。

| 象限 | 時計位置 | フェーズ | 定義 | 特徴 |
| --- | --- | --- | --- | --- |
| **北西 (NW)** | 9時〜12時 | **回復期 (Recovery)** |  | 金利低下・不況脱出・ハイテク始動 |
| **北東 (NE)** | 12時〜3時 | **好況期 (Boom)** |  | 業績拡大・輸出産業・設備投資 |
| **南東 (SE)** | 3時〜6時 | **後退期 (Slowdown)** |  | 金利高・インフレ・逆金融相場 |
| **南西 (SW)** | 6時〜9時 | **不況期 (Recession)** |  | 逆業績相場・ディフェンシブ優位 |

### 2. 採用セクターの選定 (Sector Selection)

TOPIX-17業種のうち、ノイズとなる5業種を除外し、各象限を代表する「精鋭12業種」を選抜して配置しています。

* **回復担当 (NW):** 電機・精密、情報通信、建設・資材
* **好況担当 (NE):** 自動車・輸送機、機械、商社・卸売
* **後退担当 (SE):** 銀行、金融(除く銀行)、エネルギー資源
* **不況担当 (SW):** 医薬品、食品、小売

> **除外セクターとその理由**
> * **鉄鋼・非鉄:** 機械・自動車と動きが重複するため。
> * **素材・化学:** 要因が複雑で方向感が定まりにくいため。
> * **不動産:** 銀行（金利感応）と似ているが変動が激しすぎるため。
> * **運輸・物流:** 陸運と海運が混在し、指標として不明瞭なため。
> * **電力・ガス:** 小売（内需）を優先するため今回は除外。
> 
> 

### 3. ベクトル合成 (Vector Composition)

各セクターを円周上に配置し、その「強さ」で綱引きを行います。

1. **強さの算出:**
各セクターについて、**200日移動平均線からの乖離率 (%)** を計算します。これがベクトルの「長さ（Magnitude）」になります。

2. **成分分解:**
各セクターには定位置（角度 ）が決まっています（例：自動車＝1.5時方向）。


3. **重心の決定:**
全12セクターの成分を合計し、スケーリング係数（）で調整して、市場全体の重心  を求めます。


この  座標を、過去365日分（10日刻み）プロットすることで、軌跡を描きます。

---

## ディレクトリ構成

```text
.
├── .github
│   └── workflows
│       └── update_sector_chart.yml  # GitHub Actions 定義ファイル（定期実行）
├── public                           # (自動生成) GitHub Pages公開用フォルダ
│   └── index.html                   # 生成されたチャートHTML
├── src
│   └── main.py                      # メインプログラム（計算・描画・送信）
├── requirements.txt                 # 依存ライブラリ一覧
└── README.md                        # 本書

```

---

## セットアップとデプロイ手順

### 1. 前提条件

* Python 3.11 以上
* WordPress サイト（Application Passwords プラグイン等でAPIパスワード発行済みであること）

### 2. 環境変数の設定 (GitHub Secrets)

リポジトリの `Settings` > `Secrets and variables` > `Actions` に、以下のJSONを **`WP_SECRETS_JSON`** という名前で登録してください。

```json
{
  "WP_URL": "[https://your-wordpress-site.com](https://your-wordpress-site.com)",
  "WP_USER": "your_username",
  "WP_PASSWORD": "your_application_password",
  "WP_PAGE_ID": "1234",
  "GITHUB_PAGES_URL": "https://[username].github.io/[repo-name]/"
}

```

### 3. GitHub Pages の有効化

1. リポジトリの `Settings` > `Pages` を開きます。
2. 一度 Actions を手動実行した後、Source を **`Deploy from a branch`** に設定します。
3. Branch に **`gh-pages`** を選択し、フォルダは `/(root)` を指定して Save します。

### 4. 動作確認

Actions タブからワークフローを手動実行し、全て緑色（Success）になれば完了です。
数分後に WordPress の指定ページおよび GitHub Pages のURLでチャートが確認できます。

---

## カスタマイズ

* **セクターの変更:** `src/main.py` 内の `SECTORS` リストを変更することで、計算対象を入れ替え可能です。
* **色の変更:** `src/main.py` 内の `bgPlugin` (Chart.js設定) にある `rgba(...)` 値を変更してください。
* **スケールの調整:** 現在は `-25` 〜 `+25` で固定されています。市場変動が激しい場合は `src/main.py` の `scales` 設定を調整してください。

## 免責事項

本システムは投資判断の参考情報を提供することを目的としており、特定の銘柄の売買を推奨するものではありません。投資は自己責任で行ってください。
